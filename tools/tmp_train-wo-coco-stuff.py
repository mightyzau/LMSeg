#coding=utf-8

"""
训练: ade20k + cityscapes + mapillary-vistas 数据集
测试: coco-stuff

分别看下ade20k 中和训练集中重合和不重合部分的精度
"""
import numpy as np 


if __name__ == '__main__':

    cityscape_classes = ['road', 'sidewalk', 'building', 'wall', 'fence', 'pole', 'traffic light', 'traffic sign', 'vegetation', 'terrain', 'sky', 'person', 'rider', 'car', 'truck', 'bus', 'train', 'motorcycle', 'bicycle']
    cityscape_classes = [c.split(',')[0] for c in cityscape_classes]
    assert len(cityscape_classes) == 19


    mapillary_classes = ['Bird', 'Ground Animal', 'Curb', 'Fence', 'Guard Rail', 'Barrier', 'Wall', 'Bike Lane', 'Crosswalk - Plain', 'Curb Cut', 'Parking', 'Pedestrian Area', 'Rail Track', 'Road', 'Service Lane', 'Sidewalk', 'Bridge', 'Building', 'Tunnel', 'Person', 'Bicyclist', 'Motorcyclist', 'Other Rider', 'Lane Marking - Crosswalk', 'Lane Marking - General', 'Mountain', 'Sand', 'Sky', 'Snow', 'Terrain', 'Vegetation', 'Water', 'Banner', 'Bench', 'Bike Rack', 'Billboard', 'Catch Basin', 'CCTV Camera', 'Fire Hydrant', 'Junction Box', 'Mailbox', 'Manhole', 'Phone Booth', 'Pothole', 'Street Light', 'Pole', 'Traffic Sign Frame', 'Utility Pole', 'Traffic Light', 'Traffic Sign (Back)', 'Traffic Sign (Front)', 'Trash Can', 'Bicycle', 'Boat', 'Bus', 'Car', 'Caravan', 'Motorcycle', 'On Rails', 'Other Vehicle', 'Trailer', 'Truck', 'Wheeled Slow', 'Car Mount', 'Ego Vehicle']
    mapillary_classes = [c.split(',')[0] for c in mapillary_classes]
    assert len(mapillary_classes) == 65

    coco_stuff_classes = ['person', 'bicycle', 'car', 'motorcycle', 'airplane', 'bus', 'train', 'truck', 'boat', 'traffic light', 'fire hydrant', 'stop sign', 'parking meter', 'bench', 'bird', 'cat', 'dog', 'horse', 'sheep', 'cow', 'elephant', 'bear', 'zebra', 'giraffe', 'backpack', 'umbrella', 'handbag', 'tie', 'suitcase', 'frisbee', 'skis', 'snowboard', 'sports ball', 'kite', 'baseball bat', 'baseball glove', 'skateboard', 'surfboard', 'tennis racket', 'bottle', 'wine glass', 'cup', 'fork', 'knife', 'spoon', 'bowl', 'banana', 'apple', 'sandwich', 'orange', 'broccoli', 'carrot', 'hot dog', 'pizza', 'donut', 'cake', 'chair', 'couch', 'potted plant', 'bed', 'dining table', 'toilet', 'tv', 'laptop', 'mouse', 'remote', 'keyboard', 'cell phone', 'microwave', 'oven', 'toaster', 'sink', 'refrigerator', 'book', 'clock', 'vase', 'scissors', 'teddy bear', 'hair drier', 'toothbrush', 'banner', 'blanket', 'branch', 'bridge', 'building-other', 'bush', 'cabinet', 'cage', 'cardboard', 'carpet', 'ceiling-other', 'ceiling-tile', 'cloth', 'clothes', 'clouds', 'counter', 'cupboard', 'curtain', 'desk-stuff', 'dirt', 'door-stuff', 'fence', 'floor-marble', 'floor-other', 'floor-stone', 'floor-tile', 'floor-wood', 'flower', 'fog', 'food-other', 'fruit', 'furniture-other', 'grass', 'gravel', 'ground-other', 'hill', 'house', 'leaves', 'light', 'mat', 'metal', 'mirror-stuff', 'moss', 'mountain', 'mud', 'napkin', 'net', 'paper', 'pavement', 'pillow', 'plant-other', 'plastic', 'platform', 'playingfield', 'railing', 'railroad', 'river', 'road', 'rock', 'roof', 'rug', 'salad', 'sand', 'sea', 'shelf', 'sky-other', 'skyscraper', 'snow', 'solid-other', 'stairs', 'stone', 'straw', 'structural-other', 'table', 'tent', 'textile-other', 'towel', 'tree', 'vegetable', 'wall-brick', 'wall-concrete', 'wall-other', 'wall-panel', 'wall-stone', 'wall-tile', 'wall-wood', 'water-other', 'waterdrops', 'window-blind', 'window-other', 'wood']
    coco_stuff_classes = [c.split(',')[0] for c in coco_stuff_classes]
    assert len(coco_stuff_classes) == 171

    ade20k_classes = ['wall', 'building', 'sky', 'floor', 'tree', 'ceiling', 'road, route', 'bed', 'window ', 'grass', 'cabinet', 'sidewalk, pavement', 'person', 'earth, ground', 'door', 'table', 'mountain, mount', 'plant', 'curtain', 'chair', 'car', 'water', 'painting, picture', 'sofa', 'shelf', 'house', 'sea', 'mirror', 'rug', 'field', 'armchair', 'seat', 'fence', 'desk', 'rock, stone', 'wardrobe, closet, press', 'lamp', 'tub', 'rail', 'cushion', 'base, pedestal, stand', 'box', 'column, pillar', 'signboard, sign', 'chest of drawers, chest, bureau, dresser', 'counter', 'sand', 'sink', 'skyscraper', 'fireplace', 'refrigerator, icebox', 'grandstand, covered stand', 'path', 'stairs', 'runway', 'case, display case, showcase, vitrine', 'pool table, billiard table, snooker table', 'pillow', 'screen door, screen', 'stairway, staircase', 'river', 'bridge, span', 'bookcase', 'blind, screen', 'coffee table', 'toilet, can, commode, crapper, pot, potty, stool, throne', 'flower', 'book', 'hill', 'bench', 'countertop', 'stove', 'palm, palm tree', 'kitchen island', 'computer', 'swivel chair', 'boat', 'bar', 'arcade machine', 'hovel, hut, hutch, shack, shanty', 'bus', 'towel', 'light', 'truck', 'tower', 'chandelier', 'awning, sunshade, sunblind', 'street lamp', 'booth', 'tv', 'plane', 'dirt track', 'clothes', 'pole', 'land, ground, soil', 'bannister, banister, balustrade, balusters, handrail', 'escalator, moving staircase, moving stairway', 'ottoman, pouf, pouffe, puff, hassock', 'bottle', 'buffet, counter, sideboard', 'poster, posting, placard, notice, bill, card', 'stage', 'van', 'ship', 'fountain', 'conveyer belt, conveyor belt, conveyer, conveyor, transporter', 'canopy', 'washer, automatic washer, washing machine', 'plaything, toy', 'pool', 'stool', 'barrel, cask', 'basket, handbasket', 'falls', 'tent', 'bag', 'minibike, motorbike', 'cradle', 'oven', 'ball', 'food, solid food', 'step, stair', 'tank, storage tank', 'trade name', 'microwave', 'pot', 'animal', 'bicycle', 'lake', 'dishwasher', 'screen', 'blanket, cover', 'sculpture', 'hood, exhaust hood', 'sconce', 'vase', 'traffic light', 'tray', 'trash can', 'fan', 'pier', 'crt screen', 'plate', 'monitor', 'bulletin board', 'shower', 'radiator', 'glass, drinking glass', 'clock', 'flag']
    ade20k_classes = [c.split(',')[0] for c in ade20k_classes]
    assert len(ade20k_classes) == 150



    cocostuff_mious = {'mIoU': 11.46687886438925, 'fwIoU': 29.181408998680975, 'IoU-person': 70.38673850454519, 'IoU-bicycle': 46.969142553005696, 'IoU-car': 30.128854346701306, 'IoU-motorcycle': 69.52183691485148, 'IoU-airplane': 41.89706205488128, 'IoU-bus': 57.814692042742685, 'IoU-train': 30.45236845390051, 'IoU-truck': 24.21598928921419, 'IoU-boat': 47.85999166212882, 'IoU-traffic light': 45.05490008307653, 'IoU-fire hydrant': 31.562770335806224, 'IoU-stop sign': 4.968576735370109, 'IoU-parking meter': 0.0, 'IoU-bench': 21.923542324312166, 'IoU-bird': 10.250057064219577, 'IoU-cat': 0.0, 'IoU-dog': 0.3127079243830434, 'IoU-horse': 0.0, 'IoU-sheep': 0.0, 'IoU-cow': 0.0, 'IoU-elephant': 0.0, 'IoU-bear': 0.0, 'IoU-zebra': 0.0, 'IoU-giraffe': 0.0, 'IoU-backpack': 1.0633564895292593, 'IoU-umbrella': 8.442714409691868, 'IoU-handbag': 0.31692208813980033, 'IoU-tie': 0.0, 'IoU-suitcase': 0.0, 'IoU-frisbee': 0.0, 'IoU-skis': 0.0, 'IoU-snowboard': 0.0, 'IoU-sports ball': 44.96592993797501, 'IoU-kite': 0.0, 'IoU-baseball bat': 0.0, 'IoU-baseball glove': 0.0, 'IoU-skateboard': 0.0, 'IoU-surfboard': 0.0, 'IoU-tennis racket': 10.299268082964579, 'IoU-bottle': 21.533011921186848, 'IoU-wine glass': 9.58712127439215, 'IoU-cup': 0.0, 'IoU-fork': 0.0, 'IoU-knife': 0.0, 'IoU-spoon': 0.0, 'IoU-bowl': 0.0, 'IoU-banana': 0.0, 'IoU-apple': 0.0, 'IoU-sandwich': 0.0, 'IoU-orange': 0.0, 'IoU-broccoli': 0.0, 'IoU-carrot': 0.0, 'IoU-hot dog': 0.0, 'IoU-pizza': 0.0, 'IoU-donut': 0.0, 'IoU-cake': 3.2228182817920517, 'IoU-chair': 21.174898820662342, 'IoU-couch': 33.10606483856386, 'IoU-potted plant': 3.5811148267679256, 'IoU-bed': 38.28386676076169, 'IoU-dining table': 0.07425218900639924, 'IoU-toilet': 39.107592080945935, 'IoU-tv': 15.516978880556326, 'IoU-laptop': 26.581700580480554, 'IoU-mouse': 0.0, 'IoU-remote': 0.0, 'IoU-keyboard': 0.0063920227556010095, 'IoU-cell phone': 0.0, 'IoU-microwave': 26.44255489326046, 'IoU-oven': 24.16021649661673, 'IoU-toaster': 0.0005933450420088289, 'IoU-sink': 26.59514417140068, 'IoU-refrigerator': 32.40909101779319, 'IoU-book': 4.983950223998358, 'IoU-clock': 26.007760426782152, 'IoU-vase': 12.372991328004321, 'IoU-scissors': 0.005835807830280977, 'IoU-teddy bear': 0.0, 'IoU-hair drier': 0.0, 'IoU-toothbrush': 0.0, 'IoU-banner': 1.7543598389558723, 'IoU-blanket': 0.0, 'IoU-branch': 0.0, 'IoU-bridge': 2.0714985147062217, 'IoU-building-other': 44.75542608520503, 'IoU-bush': 0.0, 'IoU-cabinet': 14.67411352910035, 'IoU-cage': 0.0, 'IoU-cardboard': 0.0, 'IoU-carpet': 12.499203145812574, 'IoU-ceiling-other': 42.42230616672435, 'IoU-ceiling-tile': 0.09927630659643126, 'IoU-cloth': 0.0, 'IoU-clothes': 8.3019292148726, 'IoU-clouds': 2.708517193425463, 'IoU-counter': 6.852441301802747, 'IoU-cupboard': 0.4307473095009994, 'IoU-curtain': 51.80491245048555, 'IoU-desk-stuff': 25.416185418806926, 'IoU-dirt': 0.0, 'IoU-door-stuff': 15.206252951892585, 'IoU-fence': 27.844631522174723, 'IoU-floor-marble': 0.0, 'IoU-floor-other': 5.102021883374, 'IoU-floor-stone': 12.78051285798093, 'IoU-floor-tile': 9.793178164870898, 'IoU-floor-wood': 0.0, 'IoU-flower': 18.7202562067602, 'IoU-fog': 0.0, 'IoU-food-other': 1.1672579081723278, 'IoU-fruit': 0.0, 'IoU-furniture-other': 0.7617885277987693, 'IoU-grass': 59.815634950749654, 'IoU-gravel': 0.0, 'IoU-ground-other': 3.870027177214391, 'IoU-hill': 6.772524370566088, 'IoU-house': 25.99905724611114, 'IoU-leaves': 0.0, 'IoU-light': 7.031100423504904, 'IoU-mat': 0.0, 'IoU-metal': 0.0, 'IoU-mirror-stuff': 17.63331355308289, 'IoU-moss': 0.0, 'IoU-mountain': 6.797949695531252, 'IoU-mud': 0.0, 'IoU-napkin': 0.1673757687582308, 'IoU-net': 0.0, 'IoU-paper': 0.0, 'IoU-pavement': 35.35392282584793, 'IoU-pillow': 0.0, 'IoU-plant-other': 5.743149600368919, 'IoU-plastic': 0.0, 'IoU-platform': 0.0, 'IoU-playingfield': 0.0, 'IoU-railing': 2.2074040009197518, 'IoU-railroad': 20.050225865773154, 'IoU-river': 17.795375933005644, 'IoU-road': 51.675123120994385, 'IoU-rock': 7.566584476090438, 'IoU-roof': 0.0, 'IoU-rug': 29.041926578070782, 'IoU-salad': 0.0, 'IoU-sand': 40.39554821730329, 'IoU-sea': 37.20976626936622, 'IoU-shelf': 10.58898594168113, 'IoU-sky-other': 51.99505581867423, 'IoU-skyscraper': 0.5035525380008369, 'IoU-snow': 25.708950680399926, 'IoU-solid-other': 0., 'IoU-stairs': 3.2380957267500774, 'IoU-stone': 0.0, 'IoU-straw': 0.0, 'IoU-structural-other': 0.0, 'IoU-table': 8.11700808501962, 'IoU-tent': 15.9651764792482, 'IoU-textile-other': 0.0, 'IoU-towel': 8.487026125087661, 'IoU-tree': 62.156062320088665, 'IoU-vegetable': 0.0, 'IoU-wall-brick': 0.09849983192488997, 'IoU-wall-concrete': 5.1487264689241155, 'IoU-wall-other': 27.9623765243344, 'IoU-wall-panel': 0.8399289359744724, 'IoU-wall-stone': 13.72108833849159, 'IoU-wall-tile': 2.3789261400850936, 'IoU-wall-wood': 0.0, 'IoU-water-other': 17.647764216324767, 'IoU-waterdrops': 0., 'IoU-window-blind': 23.157134875626074, 'IoU-window-other': 28.200849841218734, 'IoU-wood': 0.0, 'mACC': 18.80150592215063, 'pACC': 42.57364001289188, 'ACC-person': 80.5582452574708, 'ACC-bicycle': 76.81361948671916, 'ACC-car': 63.822282852662205, 'ACC-motorcycle': 75.85803859582482, 'ACC-airplane': 44.196970316739616, 'ACC-bus': 90.43351394250146, 'ACC-train': 41.71450722468549, 'ACC-truck': 38.523190255452384, 'ACC-boat': 67.55163061707572, 'ACC-traffic light': 89.7677793904209, 'ACC-fire hydrant': 32.4574409294928, 'ACC-stop sign': 5.15916555480334, 'ACC-parking meter': 0.0, 'ACC-bench': 25.51169328002108, 'ACC-bird': 12.373855363468273, 'ACC-cat': 0.0, 'ACC-dog': 0.3472254138669559, 'ACC-horse': 0.0, 'ACC-sheep': 0.0, 'ACC-cow': 0.0, 'ACC-elephant': 0.0, 'ACC-bear': 0.0, 'ACC-zebra': 0.0, 'ACC-giraffe': 0.0, 'ACC-backpack': 24.418861843421844, 'ACC-umbrella': 10.495024855961875, 'ACC-handbag': 0.35595825580454654, 'ACC-tie': 0.0, 'ACC-suitcase': 0.0, 'ACC-frisbee': 0.0, 'ACC-skis': 0.0, 'ACC-snowboard': 0.0, 'ACC-sports ball': 48.42305792704438, 'ACC-kite': 0.0, 'ACC-baseball bat': 0.0, 'ACC-baseball glove': 0.0, 'ACC-skateboard': 0.0, 'ACC-surfboard': 0.0, 'ACC-tennis racket': 11.14610107750183, 'ACC-bottle': 23.025700702194108, 'ACC-wine glass': 10.11135625766685, 'ACC-cup': 0.0, 'ACC-fork': 0.0, 'ACC-knife': 0.0, 'ACC-spoon': 0.0, 'ACC-bowl': 0.0}

    import pdb; pdb.set_trace()

    ious_not_in_3dataset = {}
    ious_in_3dataset = {}
    for k in cocostuff_mious:
        if 'IoU-' not in k:
            continue

        category = k[4:].split(',')[0]

        if category in ade20k_classes + cityscape_classes + mapillary_classes:
            ious_in_3dataset[category] = cocostuff_mious[k]
        else:
            ious_not_in_3dataset[category] = cocostuff_mious[k]
    
    print('ious_not_in_3dataset: {} classes, mIoU: {}'.format( len(ious_not_in_3dataset), np.mean(list(ious_not_in_3dataset.values())) ))
    print('ious_in_3dataset: {} classes, mIoU: {}'.format( len(ious_in_3dataset), np.mean(list(ious_in_3dataset.values())) ))
    
    print('')